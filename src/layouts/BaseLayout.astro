---
import { SEO } from 'astro-seo';
import Header from '@/components/Header.astro';
import SocialMedia from '@/components/SocialMedia.astro';
import SponsorFooter from '@/components/SponsorFooter.astro';
import '@/styles/global.css';

interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  showFooter?: boolean;
}

const {
  title = 'University of Michigan Mars Rover Team',
  description = 'The Michigan Mars Rover Team (MRover) competes in the annual University Rover Challenge. In 2018, we placed 9th in the world and 3rd in the US. Our mission is to inspire students to pursue space exploration and engineering.',
  image = 'https://mrover.org/logos/logo_short.svg',
  canonical,
  showFooter = true
} = Astro.props;

const siteUrl = 'https://mrover.org';
const canonicalURL = canonical || new URL(Astro.url.pathname, siteUrl).toString();
---

<!DOCTYPE html>
<html lang="en">
<head>
  <SEO
    title={title}
    description={description}
    canonical={canonicalURL}
    openGraph={{
      basic: {
        title: title,
        type: 'website',
        image: image,
        url: canonicalURL,
      },
      optional: {
        description: description,
        siteName: 'University of Michigan Mars Rover Team',
      },
      image: {
        alt: 'MRover Logo',
      },
    }}
    twitter={{
      card: 'summary_large_image',
      site: '@umarsteam',
      creator: '@umarsteam',
      title: title,
      description: description,
      image: image,
      imageAlt: 'MRover Logo',
    }}
    extend={{
      link: [
        { rel: 'preload', href: '/logos/logo_light_trimmed.svg', as: 'image', type: 'image/svg+xml' },
        { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' },
        { rel: 'apple-touch-icon', sizes: '180x180', href: '/icons/apple-touch-icon.png' },
        { rel: 'icon', type: 'image/png', sizes: '32x32', href: '/icons/favicon-32x32.png' },
        { rel: 'icon', type: 'image/png', sizes: '16x16', href: '/icons/favicon-16x16.png' },
        { rel: 'manifest', href: '/manifest.json' },
        { rel: 'preconnect', href: 'https://fonts.googleapis.com' },
        { rel: 'preconnect', href: 'https://fonts.gstatic.com', crossorigin: '' },
      ],
      meta: [
        { name: 'viewport', content: 'width=device-width, initial-scale=1' },
        { httpEquiv: 'X-UA-Compatible', content: 'IE=edge' },
      ],
    }}
  />

  <!-- Async Google Fonts loading to avoid render blocking -->
  <link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Inter:wght@200;300;400;500;600;700;800&family=Rajdhani:wght@300;400;500;600;700&display=swap" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Inter:wght@200;300;400;500;600;700;800&family=Rajdhani:wght@300;400;500;600;700&display=swap" media="print" onload="this.media='all'" />
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&family=Inter:wght@200;300;400;500;600;700;800&family=Rajdhani:wght@300;400;500;600;700&display=swap" /></noscript>

  <script is:inline type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Michigan Mars Rover Team",
    "alternateName": "MRover",
    "url": "https://mrover.org",
    "logo": "https://mrover.org/logos/logo_short.svg",
    "description": "The Michigan Mars Rover Team (MRover) is a student-run, multidisciplinary team at the University of Michigan building rovers for Mars exploration and competing in the University Rover Challenge.",
    "sameAs": [
      "https://www.instagram.com/umrover/",
      "https://www.facebook.com/MRoverTeam/",
      "https://www.linkedin.com/company/michigan-mars-rover-team/",
      "https://github.com/umrover"
    ],
    "parentOrganization": {
      "@type": "CollegeOrUniversity",
      "name": "University of Michigan",
      "url": "https://umich.edu"
    }
  })} />

  <!-- Dark mode script - runs before page render to prevent flash -->
  <script is:inline>
    const theme = (() => {
      if (typeof localStorage !== 'undefined' && localStorage.getItem('theme')) {
        return localStorage.getItem('theme');
      }
      if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        return 'dark';
      }
      return 'light';
    })();

    if (theme === 'dark') {
      document.documentElement.classList.add('dark');
    } else {
      document.documentElement.classList.remove('dark');
    }

    window.localStorage.setItem('theme', theme);
  </script>
  <!-- Suppress specific Three.js warnings -->
  <script is:inline>
    const originalWarn = console.warn;
    console.warn = (...args) => {
      if (args[0] && typeof args[0] === 'string' && (
        args[0].includes('THREE.ColladaLoader: You are loading an asset with a Z-UP coordinate system') ||
        args[0].includes('THREE.ColladaLoader: File version')
      )) {
        return;
      }
      originalWarn(...args);
    };
  </script>
  <!-- Smooth scrolling script -->
  <script>
    import Lenis from "lenis";
    import gsap from "gsap";
    import { ScrollTrigger } from "gsap/ScrollTrigger";

    // Initialize Lenis only if we are not on the /about page
    const path = window.location.pathname.replace(/\/$/, '');
    if (path !== '/about') {
      gsap.registerPlugin(ScrollTrigger);

      const lenis = new Lenis({
        duration: 0.8,
        easing: (t) => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
      });

      function raf(time: number) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }

      requestAnimationFrame(raf);

      lenis.on("scroll", ScrollTrigger.update);

      gsap.ticker.add((time) => {
        lenis.raf(time * 1000);
      });

      gsap.ticker.lagSmoothing(0);
    }
  </script>
</head>

<body class="font-lato text-base leading-normal text-michigan-blue antialiased">
  <Header />

  <slot />

  {showFooter && (
    <footer class="p-0 m-0">
      <SocialMedia />
      <SponsorFooter />
    </footer>
  )}
</body>
</html>
